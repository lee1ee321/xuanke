<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>3-1添加题目-单选题</title>
<link rel="stylesheet" type="text/css" href="../../css/theme/1/css/common.css">
<link rel="stylesheet" type="text/css" href="../../css/theme/1/css/style.css">
<link rel="stylesheet" type="text/css" href="../../css/theme/1/css/EditingArea.css">
<link rel="stylesheet" type="text/css" href="../../css/theme/1/css/table.css">
<link rel="stylesheet" type="text/css" href="../../css/theme/1/css/icon.css">
<link rel="stylesheet" type="text/css" href="../../css/theme/1/css/zy.css">
<script type="text/javascript" src="../../js/jquery-2.1.4/jquery.min.js"></script>
<!-- <script type="text/javascript" src="../../js/jquery.min.js"></script> -->
<!-- <script type="text/javascript"  src="../../css/theme/1/js/base.js"></script> -->
</head>

<body>
<div class="main">
	<div id="top">
    	<div class="top">
        	<div class="tk_logo"></div>
            <div class="t_sign">
            	<span>你好，管理员</span><a href="#" class="t_exit">退出</a>
            </div>
            <div class="t_icon">
            	<ul>
                	<li><a href="#" class="t1"><span>桌面</span></a></li>
                    <li><a href="#" class="t2"><span>换肤</span></a></li>
                    <li><a href="#" class="t3"><span>关于</span></a></li>
                </ul>
            </div>
        </div>
    </div>
    <div id="cont">
    	<div class="centent">
        	<div class="left c_view">
            	<ul class="baseUI">
                    <li><a href="#"><em class="base_basicset"></em><span>题库</span></a>
                        <ul>
                            <li class="current"><a href="#">全部题目</a></li>
                            <li><a href="#">题目管理</a></li>
                        </ul>
                    </li>
                    <li><a href="#"><em class="base_userset"></em><span>试卷管理</span></a>
                        <ul>
                            <li><a href="#">试卷列表</a></li>
                            <li><a href="#">手工组卷</a></li>
                        </ul>
                    </li>
                    <li><a href="#"><em class="base_teachergroup"></em><span>考试管理</span></a>
                        <ul>
                            <li><a href="#">考试列表</a></li>
                            <li><a href="#">考试安排</a></li>
                        </ul>
                    </li>
                   
                </ul>
            </div>
            <div class="right">
            	<div class="editingarea">
                    <div class="c_flex"><span class="c_flexible"></span></div>
                    <div class="Topictitle">
                           添加题目
                    </div> 
                	<div class="c_editview">
                        <div class="Problem">
                            <div class="Attributetit">题目题干
                                <label for="">类型</label>
                                <select name="" id="" class="typeSelect"></select> 
                                <label for="">难易</label>
                                <select name="" id="" class="levelSelect"></select> 
                                <label for="">方向</label>
                                <select name="" id="" class="departSelect"></select>  
                                <label for="">知识点</label>
                                <select name="" id="" class="topicSelect"></select>                     
                            </div>
                            <div class="Problemcontent" >
                                <textarea name="" id="" cols="155" rows="5"　style="width:100%;height:100%"></textarea>
                            </div>
                        </div>
                        <div class="Answeroptions">
                            <div class="Attributetit">答案选项<em>(通过勾选每个选项下面的框难吃时间点咳嗽打开)</em></div>
                            <div class="c_condition"><span class="icon_add"><em class="icon_r" style="float: left">添加选项</em></span></div>
                            <div class="Answercontent">
                                  <div class="Answerpart">
                                     <div class="Answerpart_left">
                                         <p>A</p><span><input type="radio" name="opti" correct='0'/></span>
                                     </div>
                                     <div class="Answerpart_right">
                                         <textarea name="" id="" cols="60" rows="5" style="width:100%;height:100%"></textarea>
                                     </div>
                                     <div class="clear"></div>
                                  </div>
                                <div class="Answerpart">
                                    <div class="Answerpart_left">
                                        <p>B</p><span><input type="radio" name="opti" correct='0'/></span>
                                    </div>
                                    <div class="Answerpart_right">
                                        <textarea name="" id="" cols="60" rows="5" style="width:100%;height:100%"></textarea>
                                    </div>
                                    <div class="clear"></div>
                                </div>
                                <div class="Answerpart">
                                    <div class="Answerpart_left">
                                        <p>C</p><span><input type="radio" name="opti" correct='0'/></span>
                                    </div>
                                    <div class="Answerpart_right">
                                        <textarea name="" id="" cols="60" rows="5" style="width:100%;height:100%"></textarea>
                                    </div>
                                    <div class="clear"></div>
                                </div>
                                <div class="Answerpart">
                                    <div class="Answerpart_left">
                                        <p>D</p><span><input type="radio" name="opti" correct='0'/></span>
                                    </div>
                                    <div class="Answerpart_right">
                                        <textarea name="" id="" cols="60" rows="5" style="width:100%;height:100%"></textarea>
                                    </div>
                                    <div class="clear"></div>
                                </div>
                                  <div class="clear"></div>
                            </div>
                        </div>
                        <div class="Problem">
                            <div class="Attributetit">答案解析</div>
                            <div class="Problemcontent">
                                <textarea name="" id="" cols="155" rows="4" style="width:100%;height:100%"></textarea>
                            </div>
                        </div>
                        <!-- <div class="Problem" hidden>
                            <div class="fistproblm"><span>1.</span><a href="#"></a></div>
                            <div class="Problemcontent">
                                <textarea name="" id="" cols="155" rows="4" style="width:100%;height:100%"></textarea>
                            </div>
                        </div>
                        <div class="Problem" hidden>
                            <div class="fistproblm"><span>1.</span><a href="#"></a></div>
                            <div class="Problemcontent">
                                <textarea name="" id="" cols="155" rows="4" style="width:100%;height:100%"></textarea>
                            </div>
                        </div>
                        <div class="Problem" hidden>
                            <div class="fistproblm"><span>1.</span><a href="#"></a></div>
                            <div class="Problemcontent">
                                <textarea name="" id="" cols="155" rows="4" style="width:100%;height:100%"></textarea>
                            </div>
                        </div> -->
                        <div class="btn_left">
                            <span class="btnL"><em class="btnR">保存并继续</em></span><span class="btnL"><em class="btnR">保存并关闭</em></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </div>
    <div id="foot"><a href="#">上海师悦信息科技有限公司</a></div>
</div>
</body>
</html>

<script>
    $(function(){
        $.getJSON('/exam/manager/getAllSubjectType',function(results){
            results.forEach(function(item,index){
                $('.typeSelect').append("<option id='"+item.id+"' value='"+item.name+"'>"+item.realName+"</option>")
            })
        }); 
        $.getJSON('/exam/manager/getAllSubjectLevel',function(results){
            results.forEach(function(item,index){
                $('.levelSelect').append("<option id='"+item.id+"' value='"+item.name+"'>"+item.realName+"</option>")
            })
        });
        $.getJSON('/exam/manager/getAllDepartmentes',function(results){
            results.forEach(function(item,index){
                $('.departSelect').append("<option id='"+item.id+"' value='"+item.name+"'>"+item.name+"</option>")
            })
        });
        $.getJSON('/exam/manager/getAllTopics',function(results){
            results.forEach(function(item,index){
                $('.topicSelect').append("<option id='"+item.id+"' department_id='"+item.department_id+"'>"+item.title+"</option>")
            })
        });
        
        //获取ｉｄ  点击ｏｐｔｉｏｎ　改变页面
        $('.typeSelect').click(function(event){
             if($(event.target).attr('id')){
                // $('.Problemcontent').eq(0).hide();
                $('.Answeroptions').show();
                $('.Problem').show();
             }
            if($(event.target).attr('id')==1){
                $('.Answerpart_left input').attr('type','radio');
            }
            if($(event.target).attr('id')==2){
                $('.Answerpart_left input').attr('type','checkbox');
            }
           if($(event.target).attr('id')==3){
                // console.log($(event.target).attr('id'))
                // $('.Problemcontent').show();
                $('.Answeroptions').hide();
                $('.Problem').hide();
                $('.Problem').eq(0).show();
                $('.Problem').eq(1).show();
            }   
        })
        //点击添加选项 产生新的选项卡
        var arr=['E','F','G','H','I','J','K','L','M','N'];
        var index=0;
        $('.icon_add').click(function(){
            var div=$('.Answerpart').eq(0).clone(true);
            div.find('p').text(arr[index]);
            $('.Answercontent').append(div);
            index++;
        })

        //点击保存并继续　把数据存储到数据库中
            
        $('.btnR').eq(0).click(function(event){
            var subjectType_id=$('.typeSelect option:checked').attr('id');
            var subjectLevel_id=$('.levelSelect option:checked').attr('id');
            var subjectDepart_id=$('.departSelect option:checked').attr('id');
            var subjectTopic_id=$('.topicSelect option:checked').attr('department_id');
            var ids=[subjectType_id,subjectLevel_id,subjectDepart_id,subjectTopic_id];
            var stem=$('.Problemcontent').eq(0).children('textarea').val();
            var answer_analysis=$('.Problemcontent').eq(1).children('textarea').val();
            var answerA=$(".Answerpart_left:contains('A')").siblings().children('textarea').val()
            var answerB=$(".Answerpart_left:contains('B')").siblings().children('textarea').val()
            var answerC=$(".Answerpart_left:contains('C')").siblings().children('textarea').val()
            var answerD=$(".Answerpart_left:contains('D')").siblings().children('textarea').val()
            var answerOther=$(".Answerpart_left:contains('"+arr[index-1]+"')").siblings().children('textarea').val()
            var content=[answerA,answerB,answerC,answerD];
            $('input').attr('correct','0');
            var corrects=[];
            $('input:checked').attr('correct','1');
            $('input').each(function(index,item){
                corrects.push($(item).attr('correct'))  
            })
            // console.log(corrects);
            $.ajax({
                url:'/exam/manager/saveSubject',
                method:'post',
                data:{
                    ids:ids,
                    "stem":stem,
                    "answer":answer_analysis
                },
                success:function(data){
                    if(subjectType_id==1||subjectType_id==2){
                        console.log(subjectType_id)
                        var id=data.insertId;
                        $.ajax({
                        url:'/exam/manager/saveChoice',
                        method:'post',
                        data:{
                        "subject_id":id,
                        "content":content,
                        "corrects":corrects
                        },
                        success:function(data){
                            console.log(data);
                        }
                    })
                   }
                }
            })
            window.location.reload();
        })
        $('.btnR').eq(1).click(function(event){
            $("body").load('../../index.html'); 
            $(".divtable").load('../题目类型.html');
        })
    })
</script>
